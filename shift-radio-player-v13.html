<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHIFT TTF RADIO Player</title>
</head>
<body>
    <!-- SHIFT TTF Radio Player v13 - WordPress Embed Version with Now Playing -->
    <div id="shift-radio-widget">
        <style>
            #shift-radio-widget {
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            }

            #shift-radio-widget * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            #shift-radio-widget .shift-player-container {
                width: 100%;
                background: white;
                border: 1px solid black;
                padding: 30px;
            }

            #shift-radio-widget .shift-logo-section {
                text-align: center;
                margin-bottom: 30px;
            }

            #shift-radio-widget .shift-logo {
                width: 120px;
                height: auto;
                margin: 0 auto 10px;
            }

            #shift-radio-widget .shift-logo img {
                width: 100%;
                height: auto;
                display: block;
            }

            #shift-radio-widget .shift-station-name {
                font-size: 14px;
                letter-spacing: 2px;
                font-weight: 300;
                color: #000;
            }

            #shift-radio-widget .shift-controls {
                display: flex;
                align-items: center;
                gap: 20px;
                margin-bottom: 0;
                padding: 20px 0;
                border-top: 1px solid black;
                border-bottom: 1px solid black;
            }

            #shift-radio-widget .shift-play-button {
                width: 50px;
                height: 50px;
                border: 1px solid black;
                background: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
                padding: 0;
            }

            #shift-radio-widget .shift-play-button:hover {
                background: #f0f0f0;
            }

            #shift-radio-widget .shift-play-icon, 
            #shift-radio-widget .shift-pause-icon {
                width: 20px;
                height: 20px;
            }

            #shift-radio-widget .shift-volume-control {
                flex: 1;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            #shift-radio-widget .shift-volume-icon {
                width: 20px;
                height: 20px;
            }

            #shift-radio-widget .shift-volume-slider {
                flex: 1;
                height: 1px;
                background: black;
                position: relative;
                cursor: pointer;
            }

            #shift-radio-widget .shift-volume-track {
                height: 100%;
                background: black;
                width: 70%;
                position: relative;
            }

            #shift-radio-widget .shift-volume-handle {
                width: 12px;
                height: 12px;
                border: 1px solid black;
                background: white;
                position: absolute;
                right: -6px;
                top: 50%;
                transform: translateY(-50%);
                cursor: pointer;
            }

            #shift-radio-widget .shift-now-playing {
                background: #f9f9f9;
                padding: 10px 15px;
                margin-bottom: 30px;
                height: 40px;
                display: flex;
                align-items: center;
                overflow: hidden;
                position: relative;
                border: 1px solid #e0e0e0;
            }

            #shift-radio-widget .shift-now-playing-label {
                font-size: 9px;
                text-transform: uppercase;
                letter-spacing: 1px;
                color: #999;
                font-weight: 500;
                margin-right: 12px;
                flex-shrink: 0;
                min-width: 70px;
            }

            #shift-radio-widget .shift-track-ticker {
                flex: 1;
                overflow: hidden;
                position: relative;
            }

            #shift-radio-widget .shift-track-ticker-wrapper {
                position: relative;
                overflow: hidden;
                width: 100%;
                mask-image: linear-gradient(to right, transparent, black 10px, black calc(100% - 10px), transparent);
                -webkit-mask-image: linear-gradient(to right, transparent, black 10px, black calc(100% - 10px), transparent);
            }

            #shift-radio-widget .shift-track-text {
                display: inline-block;
                white-space: nowrap;
                padding-right: 100px;
                animation: scroll 25s linear infinite;
                font-size: 13px;
                color: #333;
            }
            
            #shift-radio-widget .shift-track-text strong {
                font-weight: 500;
                color: #000;
            }

            #shift-radio-widget .shift-track-text:hover {
                animation-play-state: paused;
            }

            @keyframes scroll {
                0% {
                    transform: translateX(0%);
                }
                100% {
                    transform: translateX(-50%);
                }
            }

            /* Safari-specific handling */
            @supports (-webkit-backdrop-filter: none) {
                #shift-radio-widget .shift-track-text {
                    animation: scroll-safari 25s linear infinite;
                }
                
                @keyframes scroll-safari {
                    from {
                        -webkit-transform: translateX(0%);
                        transform: translateX(0%);
                    }
                    to {
                        -webkit-transform: translateX(-50%);
                        transform: translateX(-50%);
                    }
                }
            }

            #shift-radio-widget .shift-track-text.no-scroll {
                animation: none;
                transform: none;
                padding-right: 0;
            }

            #shift-radio-widget .shift-track-separator {
                margin: 0 8px;
                color: #ccc;
                font-weight: 300;
            }

            #shift-radio-widget .shift-now-playing-empty {
                font-size: 12px;
                color: #999;
                font-style: italic;
            }

            #shift-radio-widget .shift-show-info {
                margin-bottom: 25px;
            }

            #shift-radio-widget .shift-show-label {
                font-size: 10px;
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 10px;
                color: #666;
                font-weight: normal;
            }

            #shift-radio-widget .shift-show-title {
                font-size: 18px;
                font-weight: 500;
                margin-bottom: 8px;
                color: #000;
            }

            #shift-radio-widget .shift-show-time {
                font-size: 13px;
                color: #666;
                margin-bottom: 8px;
            }

            #shift-radio-widget .shift-show-url {
                font-size: 12px;
                margin-bottom: 10px;
            }

            #shift-radio-widget .shift-show-url a {
                color: #666;
                text-decoration: none;
                word-break: break-all;
            }

            #shift-radio-widget .shift-show-url a:hover {
                color: #000;
                text-decoration: underline;
            }

            #shift-radio-widget .shift-show-description {
                font-size: 13px;
                line-height: 1.5;
                color: #333;
                position: relative;
            }

            #shift-radio-widget .shift-description-text {
                display: -webkit-box;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
                transition: all 0.3s;
            }

            #shift-radio-widget .shift-description-text.expanded {
                -webkit-line-clamp: unset;
            }

            #shift-radio-widget .shift-expand-button {
                display: inline-block;
                margin-top: 5px;
                font-size: 11px;
                color: #666;
                cursor: pointer;
                border: none;
                background: none;
                padding: 0;
                font-family: inherit;
            }

            #shift-radio-widget .shift-expand-button:hover {
                color: #000;
            }

            #shift-radio-widget .shift-expand-arrow {
                display: inline-block;
                margin-left: 3px;
                transition: transform 0.3s;
            }

            #shift-radio-widget .shift-expand-arrow.rotated {
                transform: rotate(180deg);
            }

            #shift-radio-widget .shift-next-show {
                padding-top: 20px;
                border-top: 1px solid #e0e0e0;
            }

            #shift-radio-widget .shift-loading {
                text-align: center;
                color: #666;
                font-size: 13px;
            }

            #shift-radio-widget .shift-error {
                color: #ff0000;
                font-size: 13px;
                text-align: center;
            }
        </style>

        <div class="shift-player-container">
            <div class="shift-logo-section">
                <div class="shift-logo">
                    <img src="shift-logo.jpg" alt="SHIFT TTF RADIO Logo" onerror="this.style.display='none'">
                </div>
                <div class="shift-station-name">SHIFT TTF RADIO</div>
            </div>

            <div class="shift-controls">
                <button class="shift-play-button" id="shiftPlayButton">
                    <svg class="shift-play-icon" id="shiftPlayIcon" viewBox="0 0 20 20" fill="none" stroke="black" stroke-width="1">
                        <polygon points="6,4 16,10 6,16" fill="black"/>
                    </svg>
                    <svg class="shift-pause-icon" id="shiftPauseIcon" viewBox="0 0 20 20" fill="none" stroke="black" stroke-width="1" style="display:none;">
                        <rect x="6" y="4" width="3" height="12" fill="black"/>
                        <rect x="11" y="4" width="3" height="12" fill="black"/>
                    </svg>
                </button>
                
                <div class="shift-volume-control">
                    <svg class="shift-volume-icon" viewBox="0 0 20 20" fill="none" stroke="black" stroke-width="1">
                        <polygon points="4,7 8,7 12,3 12,17 8,13 4,13" fill="black"/>
                        <path d="M14,7 Q16,10 14,13" fill="none"/>
                    </svg>
                    <div class="shift-volume-slider" id="shiftVolumeSlider">
                        <div class="shift-volume-track" id="shiftVolumeTrack">
                            <div class="shift-volume-handle" id="shiftVolumeHandle"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="shift-now-playing" id="shiftNowPlaying">
                <div class="shift-now-playing-label">NOW PLAYING</div>
                <div class="shift-now-playing-empty">Loading track information...</div>
            </div>

            <div class="shift-show-info" id="shiftCurrentShow">
                <div class="shift-show-label">CURRENT SHOW</div>
                <div class="shift-loading">Loading show information...</div>
            </div>

            <div class="shift-show-info shift-next-show" id="shiftNextShow">
                <div class="shift-show-label">NEXT SHOW</div>
                <div class="shift-loading">Loading show information...</div>
            </div>
        </div>

        <audio id="shiftAudioPlayer" preload="none" playsinline>
            <source src="https://shift.out.airtime.pro:8000/shift_a" type="audio/mpeg">
            <source src="https://shift.out.airtime.pro:8000/shift_a" type="audio/ogg">
        </audio>
    </div>

    <script>
    (function() {
        'use strict';
        
        // Namespace all functions to avoid conflicts
        const ShiftRadio = {
            audioPlayer: null,
            playButton: null,
            playIcon: null,
            pauseIcon: null,
            volumeSlider: null,
            volumeTrack: null,
            volumeHandle: null,
            currentShowDiv: null,
            nextShowDiv: null,
            nowPlayingDiv: null,
            isPlaying: false,
            isDragging: false,

            init: function() {
                // Get elements with shift-specific IDs
                this.audioPlayer = document.getElementById('shiftAudioPlayer');
                this.playButton = document.getElementById('shiftPlayButton');
                this.playIcon = document.getElementById('shiftPlayIcon');
                this.pauseIcon = document.getElementById('shiftPauseIcon');
                this.volumeSlider = document.getElementById('shiftVolumeSlider');
                this.volumeTrack = document.getElementById('shiftVolumeTrack');
                this.volumeHandle = document.getElementById('shiftVolumeHandle');
                this.currentShowDiv = document.getElementById('shiftCurrentShow');
                this.nextShowDiv = document.getElementById('shiftNextShow');
                this.nowPlayingDiv = document.getElementById('shiftNowPlaying');

                // Check if all elements exist
                if (!this.audioPlayer || !this.playButton) {
                    console.error('SHIFT Radio: Required elements not found');
                    return;
                }

                this.setupEventListeners();
                this.fetchShowInfo();
                this.fetchNowPlaying();
                
                // Refresh show info every minute
                setInterval(() => this.fetchShowInfo(), 60000);
                
                // Refresh now playing every 30 seconds
                setInterval(() => this.fetchNowPlaying(), 30000);
                
                // Set initial volume to 70%
                if (this.audioPlayer) {
                    this.audioPlayer.volume = 0.7;
                }
            },

            setupEventListeners: function() {
                const self = this;

                // Play/Pause functionality
                this.playButton.addEventListener('click', function() {
                    self.togglePlayPause();
                });

                // Volume control
                this.volumeSlider.addEventListener('mousedown', function(e) {
                    self.isDragging = true;
                    self.updateVolume(e.clientX);
                });

                document.addEventListener('mousemove', function(e) {
                    if (self.isDragging) {
                        self.updateVolume(e.clientX);
                    }
                });

                document.addEventListener('mouseup', function() {
                    self.isDragging = false;
                });

                // Handle audio errors
                this.audioPlayer.addEventListener('error', function(e) {
                    console.error('Audio error:', e);
                    if (self.isPlaying) {
                        setTimeout(function() {
                            self.audioPlayer.load();
                            self.audioPlayer.play().catch(err => console.error('Reconnection failed:', err));
                        }, 2000);
                    }
                });

                // Update UI when audio actually plays/pauses
                this.audioPlayer.addEventListener('play', function() {
                    self.playIcon.style.display = 'none';
                    self.pauseIcon.style.display = 'block';
                    self.isPlaying = true;
                });

                this.audioPlayer.addEventListener('pause', function() {
                    self.playIcon.style.display = 'block';
                    self.pauseIcon.style.display = 'none';
                    self.isPlaying = false;
                });
            },

            togglePlayPause: function() {
                if (this.isPlaying) {
                    this.audioPlayer.pause();
                } else {
                    this.audioPlayer.play().catch(e => {
                        console.error('Playback failed:', e);
                        alert('Please click play again to start the stream.');
                    });
                }
            },

            updateVolume: function(x) {
                const rect = this.volumeSlider.getBoundingClientRect();
                let percentage = (x - rect.left) / rect.width;
                percentage = Math.max(0, Math.min(1, percentage));
                
                this.volumeTrack.style.width = (percentage * 100) + '%';
                this.audioPlayer.volume = percentage;
            },

            formatTime: function(dateString) {
                if (!dateString) return '';
                
                // Extract time directly since it's already in London timezone
                const match = dateString.match(/(\d{2}):(\d{2})/);
                return match ? `${match[1]}:${match[2]}` : '';
            },

            fetchNowPlaying: async function() {
                try {
                    const response = await fetch('https://shift.airtime.pro/api/live-info-v2');
                    const data = await response.json();
                    
                    let trackInfo = null;
                    
                    // Try different data structures
                    if (data.tracks && data.tracks.current) {
                        trackInfo = data.tracks.current;
                    } else if (data.current && data.current.metadata) {
                        trackInfo = data.current.metadata;
                    } else if (data.current) {
                        trackInfo = data.current;
                    }
                    
                    if (trackInfo) {
                        // Extract track details with multiple fallbacks (creator first for artist)
                        const trackName = trackInfo.title || trackInfo.name || trackInfo.track_title || 'Unknown Track';
                        const artistName = trackInfo.creator || trackInfo.artist || trackInfo.artist_name || '';
                        const albumName = trackInfo.album || trackInfo.album_title || '';
                        const year = trackInfo.year || '';
                        
                        // Build the scrolling text
                        let tickerText = `<strong>${trackName}</strong>`;
                        if (artistName) {
                            tickerText += `<span class="shift-track-separator">•</span>${artistName}`;
                        }
                        if (albumName) {
                            tickerText += `<span class="shift-track-separator">•</span>${albumName}`;
                        }
                        if (year) {
                            tickerText += `<span class="shift-track-separator">•</span>${year}`;
                        }
                        
                        // Duplicate for seamless scrolling
                        const fullText = tickerText + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + tickerText;
                        
                        // Check if text is long enough to need scrolling
                        const needsScroll = (trackName + artistName + albumName + year).length > 50;
                        
                        this.nowPlayingDiv.innerHTML = `
                            <div class="shift-now-playing-label">NOW PLAYING</div>
                            <div class="shift-track-ticker">
                                <div class="shift-track-text ${needsScroll ? '' : 'static'}">
                                    ${needsScroll ? fullText : tickerText}
                                </div>
                            </div>
                        `;
                    } else {
                        this.nowPlayingDiv.innerHTML = `
                            <div class="shift-now-playing-label">NOW PLAYING</div>
                            <div class="shift-now-playing-empty">No track information available</div>
                        `;
                    }
                    
                } catch (error) {
                    console.error('Error fetching now playing info:', error);
                    this.nowPlayingDiv.innerHTML = `
                        <div class="shift-now-playing-label">NOW PLAYING</div>
                        <div class="shift-now-playing-empty">Unable to load track information</div>
                    `;
                }
            },

            fetchShowInfo: async function() {
                try {
                    const response = await fetch('https://shift.airtime.pro/api/live-info-v2');
                    const data = await response.json();
                    
                    // Current show
                    if (data.shows && data.shows.current) {
                        const current = data.shows.current;
                        const currentHtml = `
                            <div class="shift-show-label">CURRENT SHOW</div>
                            <div class="shift-show-title">${current.name || 'Unknown Show'}</div>
                            <div class="shift-show-time">${this.formatTime(current.starts)} - ${this.formatTime(current.ends)}</div>
                            ${current.url ? `<div class="shift-show-url"><a href="${current.url}" target="_blank" rel="noopener noreferrer">${current.url}</a></div>` : ''}
                            ${current.description ? `
                                <div class="shift-show-description">
                                    <div class="shift-description-text" id="shiftCurrentDesc">
                                        ${current.description}
                                    </div>
                                    ${current.description.length > 200 ? `
                                        <button class="shift-expand-button" onclick="ShiftRadio.toggleDescription('shiftCurrentDesc', this)">
                                            Show more <span class="shift-expand-arrow">▼</span>
                                        </button>
                                    ` : ''}
                                </div>
                            ` : ''}
                        `;
                        this.currentShowDiv.innerHTML = currentHtml;
                    } else {
                        this.currentShowDiv.innerHTML = '<div class="shift-show-label">CURRENT SHOW</div><div class="shift-show-title">No show information available</div>';
                    }
                    
                    // Next show
                    if (data.shows && data.shows.next && data.shows.next.length > 0) {
                        const next = data.shows.next[0];
                        const nextHtml = `
                            <div class="shift-show-label">NEXT SHOW</div>
                            <div class="shift-show-title">${next.name || 'Unknown Show'}</div>
                            <div class="shift-show-time">${this.formatTime(next.starts)} - ${this.formatTime(next.ends)}</div>
                            ${next.url ? `<div class="shift-show-url"><a href="${next.url}" target="_blank" rel="noopener noreferrer">${next.url}</a></div>` : ''}
                        `;
                        this.nextShowDiv.innerHTML = nextHtml;
                    } else {
                        this.nextShowDiv.innerHTML = '<div class="shift-show-label">NEXT SHOW</div><div class="shift-show-title">No upcoming show scheduled</div>';
                    }
                    
                } catch (error) {
                    console.error('Error fetching show info:', error);
                    this.currentShowDiv.innerHTML = '<div class="shift-show-label">CURRENT SHOW</div><div class="shift-error">Unable to load show information</div>';
                    this.nextShowDiv.innerHTML = '<div class="shift-show-label">NEXT SHOW</div><div class="shift-error">Unable to load show information</div>';
                }
            },

            toggleDescription: function(id, button) {
                const desc = document.getElementById(id);
                const arrow = button.querySelector('.shift-expand-arrow');
                
                desc.classList.toggle('expanded');
                arrow.classList.toggle('rotated');
                
                if (desc.classList.contains('expanded')) {
                    button.innerHTML = 'Show less <span class="shift-expand-arrow rotated">▼</span>';
                } else {
                    button.innerHTML = 'Show more <span class="shift-expand-arrow">▼</span>';
                }
            }
        };

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                ShiftRadio.init();
            });
        } else {
            ShiftRadio.init();
        }

        // Make toggle function globally available for onclick handlers
        window.ShiftRadio = ShiftRadio;
    })();
    </script>
</body>
</html>